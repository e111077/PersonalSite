<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/custom-style.html">
<link rel="import" href="../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="elliott-top-bar.html">
<link rel="import" href="elliott-pages.html">
<link rel="import" href="elliott-shared-styles.html">

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">


<dom-module id="elliott-main-page">
<template>
  <custom-style>
    <style include="elliott-shared-styles">
      #controls {
        display: flex;
        justify-content: center;
        margin-top: 16px;
        margin-bottom: 16px;
      }

      .pageButton {
        margin: 5px;
        padding: 6px;
        font-size: 3em;
        font-family: var(--main-font);
        cursor: pointer;
        cursor: hand;
        border: 1px solid black;
      }

      .pageButton.selected {
        background-color: black;
        color: white;
      }
    </style>
  </custom-style>

  <app-location route="{{route}}"></app-location>
  <app-route route="{{route}}" pattern="/:page" data="{{data}}"></app-route>

  <elliott-top-bar></elliott-top-bar>

  <div id="controls">
    <span class="pageButton selected" on-tap="_onControlButtonClick" page="about">about</span>
    <span class="pageButton" on-tap="_onControlButtonClick" page="projects">projects</span>
    <span class="pageButton" on-tap="_onControlButtonClick" page="resume">resume</span>
  </div>

  <elliott-pages id="pages" attribute="name" selected="[[page]]">
    <elliott-about-me name="about" age="[[age]]" pc="[[pc]]"></elliott-about-me>
    <elliott-projects
          id="myProjects"
          name="projects">
    </elliott-projects>
    <elliott-resume-section name="resume" last-updated="[[lastUpdated]]"></elliott-resume-section>
  </elliott-pages>
</template>

<script>
  let isChrome = document.body.animate && !('scrollBehavior' in document.documentElement.style);
  if (isChrome) {
    warning.parentNode.removeChild(warning);
  }

  const PAGE_MAP = {
    about: 'elliott-about-me.html',
    projects: 'elliott-projects.html',
    resume: 'elliott-resume-section.html'
  };

  class MainPage extends Polymer.GestureEventListeners(Polymer.Element) {
    static get is() { return 'elliott-main-page' }

    static get properties() {
      return {
        lastUpdated: {
          type: Number,
          value: 'September 2015'
        },

        age: {
          type: Number,
          value: 22
        },

        pc: {
          type: Object,
          value: {
            photographer: 'Sean Ebsworth Barnes',
            website: 'http://www.seanebsworthbarnes.com/Clients/Google-Polymer-London-2016/Keynotes-Monday-Polymer16/n-x6mZp5/i-44ZTM88'
          }
        },

        route: {
          type: Object
        },

        data: {
          type: Object
        },

        page: {
          type: String,
          value: 'about',
          observer: '_pageChanged'
        },

        __isAttached: {
          type: Boolean
        }
      };
    }

    static get observers() {
      return ['__dataPageChanged(data.page)'];
    }

    connectedCallback() {
      super.connectedCallback();
      this.__isAttached = true;

      if (this.page) {
        this._pageChanged(this.page);
      }
    }

    _pageChanged(newPage) {
      if (!newPage || !this.__isAttached || !(newPage in PAGE_MAP)) {
        return;
      }

      this.$.controls.querySelector('.selected').classList.remove('selected');
      this.$.controls.querySelector(`[page="${newPage}"]`).classList.add('selected');

      if (this.data.page !== newPage) {
        this.set('data.page', newPage);
      }

      Polymer.Base.importHref(this.resolveUrl(PAGE_MAP[newPage]), null, null, true);
    }

    _onControlButtonClick(event) {
      this.page = event.target.getAttribute('page');
    }

    __dataPageChanged(newPage) {
      if (this.data.page && this.__isAttached && this.data.page in PAGE_MAP) {
        this.page = this.data.page;
      }
    }
  }

  customElements.define(MainPage.is, MainPage);
</script>
</dom-module>